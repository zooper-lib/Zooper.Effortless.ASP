name: Publish NuGet Package for ZEA.Architecture.Patterns.StrongTypes.Generator

on:
  push:
    branches:
      - main
      - develop
    paths:
      - '**/ZEA.Architecture.Patterns.StrongTypes.Generator/**'
  
  workflow_dispatch:  # Allows manual triggering of the workflow

jobs:
  extract-version:
    runs-on: ubuntu-latest
    env:
      projectName: ZEA.Architecture.Patterns.StrongTypes.Generator
    steps:
      - uses: actions/checkout@v3
        
      # Use the get-csproj-version action to extract the version
      - name: Get .csproj Version
        id: get_version
        uses: KageKirin/get-csproj-version@v0
        with:
          file: 'Architecture/Patterns/StrongTypes/ZEA.Architecture.Patterns.StrongTypes.Generator/ZEA.Architecture.Patterns.StrongTypes.Generator.csproj'  # Path to the specific .csproj file
          
      - name: Echo the semantic version
        run: |
          echo "Semantic version being passed: ${{ needs.extract-version.outputs.VERSION }}"
    
    outputs:
      VERSION: ${{ steps.get_version.outputs.VERSION }}
      PROJECT_PATH: '**/ZEA.Architecture.Patterns.StrongTypes.Generator.csproj'

  call-template:
    needs: extract-version
    uses: ./.github/workflows/template_nuget_build_and_push.yml
    with:
      projectPath: ${{ needs.extract-version.outputs.PROJECT_PATH }}
      buildConfiguration: Release
      semanticVersion: ${{ needs.extract-version.outputs.VERSION }}
      isPreRelease: ${{ github.ref != 'refs/heads/main' }}
      buildVersion: ${{ github.run_number }}
      
    